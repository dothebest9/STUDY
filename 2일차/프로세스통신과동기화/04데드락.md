1.데드락

프로세스 실행 과정에서 발생할 수 있는 정체 상황을 Deadlock (데드락), '교착 상태'라고 한다.

프로세스들은 서로 다른 프로세스의 작업이 끝나기를 기다린다. 

그런데 기다리는 대상이 꼬리에 꼬리를 물고 이어져 아무도 작업하지 못하는 상태를 데드락이라 한다.

예를 들어 한 사람이 책을 빌렸는데 해당 책을 잃어버려 계속해서 연체가 되었다. 

도서관 사서는 해당 책이 반납될 때 까지 계속 기다리게 되고, 

새로운 사람이 해당 책을 대출받고 싶어한다면 대출해주지 못하고 기다리게만 된다.

이렇게 세 사람 모두 아무것도 못하는 상황을 데드락, 교착 상태라고 할 수 있다.

이는 공유 자원이 있기 때문에 생길 수 있는 문제다.

데드락은 아무때나 발생하지 않는다. 

2.데드락의 네 가지 조건

상호 배제 (Mutual exclusion): 어떤 프로세스가 어떤 공유 자원을 사용하고 있다면 해당 공유 자원은 다른 프로세스가 접근할 수 없어야한다.

비선점 (No preemption): 어떤 프로세스가 어떤 공유 자원을 가지고 있을 때 다른 프로세스가 해당 공유 자원을 빼엇을 수 없어야한다.

점유 및 대기 (Hold and wait): 어떤 프로세스가 어떤 공유 자원을 가지고 있을 때 다른 프로세스가 해당 공유 자원을 사용하기 위해 기다리고 있어야한다.

원형 대기 (Circular wait): 점유 및 대기를 하는 프로세스들의 관계가 꼬리에 꼬리를 물어 원형을 형성하고 있어야한다.

3.식사하는 철학자 문제

다섯 명의 철학자가 하나의 원탁에 앉아 식사를 한다. 

각각의 철학자들 사이에는 포크가 하나씩 있고, 앞에는 접시가 있다. 

접시 안에 든 요리는 양손에 포크를 하나씩 잡고 사용해 먹어야만 하는 스파게티 이다. 

그리고 각각의 철학자는 다른 철학자에게 말을 할 수 없으며, 번갈아가며 각자 식사하거나 생각하는 것만 가능하다. 
따라서 식사를 하기 위해서는 왼쪽과 오른쪽의 인접한 철학자가 모두 식사를 하지 않고 생각하는 중이어야 한다. 

또한 식사를 마치고 나면, 왼손과 오른손에 든 포크를 다른 철학자가 쓸 수 있도록 내려놓아야 한다. 

마지막으로, 각 철학자는 서로가 배가 고픈지 단지 생각하는 중인지 알 수 없다고 가정한다. 

이 때, 어떤 철학자도 굶지 않고 식사할 수 있도록 하는 방법은 무엇인가?

A.최대 동시 식사 인원 제한 (환형 대기 방지)

원탁에 앉을 수 있는 철학자의 수를 총 포크 개수보다 하나 적게 제한합니다. 

(예: 포크 5개일 때, 최대 4명의 철학자만 착석 허용)

원리: 5개의 포크 중 4명이 각각 포크 1개씩을 들고 있어도 (최대 4개 사용), 

마지막 남은 1개의 포크는 반드시 누군가에게 할당되어 최소 한 명은 양쪽 포크 2개를 모두 획득하고 식사할 수 있게 됩니다. 

한 명이 식사를 마치고 포크를 내려놓으면, 다른 철학자들도 순차적으로 식사를 계속할 수 있어 교착 상태가 해소됩니다.

B. 포크 동시 획득 (보유 및 대기 방지)

철학자가 식사를 시도할 때 양쪽 포크 2개를 모두 동시에 획득할 수 있을 때만 포크를 들도록 합니다.

원리: 포크 1개만 들고 다른 포크를 기다리는 상황(점유 대기)을 원천적으로 차단합니다. 

둘 중 하나라도 사용 중이면 아예 포크를 들지 않고 기다립니다. 

이는 모니터(Monitor)와 같은 동기화 메커니즘을 사용하여 구현될 수 있습니다.

C. 비대칭 포크 획득 순서 (환형 대기 방지)
철학자들이 포크를 집는 순서에 비대칭성을 부여하여 환형 대기(순환) 구조를 끊습니다.

예시:홀수 번호 철학자: 왼쪽 포크를 먼저 집고, 오른쪽 포크를 집는다.

짝수 번호 철학자: 오른쪽 포크를 먼저 집고, 왼쪽 포크를 집는다.

원리: 모든 철학자가 동시에 왼쪽 포크를 집는 상황이 발생하더라도, 

짝수 번호 철학자는 오른쪽 포크를 집어야 하므로 행동이 달라지게 됩니다. 

이는 포크를 획득하는 순서(자원 순서화)를 정의하여 순환 대기 상황을 막습니다.

D.기아 상태 및 시간 제한 적용

교착 상태 해결법들이 구현되었더라도, 특정 철학자가 영원히 식사를 하지 못하는 기아 상태가 발생할 수 있습니다.

타임아웃(Timeout) 설정: 철학자가 포크를 들고 일정 시간 내에 반대쪽 포크를 획득하지 못하면, 

들었던 포크를 내려놓고 다시 대기하도록 하여 다른 철학자가 기회를 얻게 합니다.

우선순위 부여: 포크를 획득하는 데 더 오래 기다린 철학자에게 우선순위를 부여하는 등의 방법을 고려할 수 있습니다.
